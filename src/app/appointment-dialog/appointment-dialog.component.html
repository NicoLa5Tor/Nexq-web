<h2 class="dialog-title">Agendar Consultoría</h2>
<mat-vertical-stepper #stepper linear *ngIf="!showSuccess" class="appointment-stepper">
  <mat-step [stepControl]="personalGroup">
    <form [formGroup]="personalGroup">
      <ng-template matStepLabel>Datos Personales</ng-template>
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="firstName" required>
          <mat-error *ngIf="personalGroup.get('firstName')?.hasError('required')">Requerido</mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Apellido</mat-label>
          <input matInput formControlName="lastName" required>
          <mat-error *ngIf="personalGroup.get('lastName')?.hasError('required')">Requerido</mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" required type="email">
          <mat-error *ngIf="personalGroup.get('email')?.hasError('email')">Correo inválido</mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Teléfono</mat-label>
          <input matInput formControlName="phone" required>
          <mat-error *ngIf="personalGroup.get('phone')?.invalid">Teléfono inválido</mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Empresa</mat-label>
          <input matInput formControlName="company" required>
          <mat-error *ngIf="personalGroup.get('company')?.hasError('required')">Requerido</mat-error>
        </mat-form-field>
      </div>
      <div class="step-actions">
        <button mat-raised-button color="primary" (click)="stepper.next()" [disabled]="personalGroup.invalid">Continuar</button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="serviceGroup">
    <form [formGroup]="serviceGroup">
      <ng-template matStepLabel>Servicio</ng-template>
      <mat-selection-list formControlName="service" class="service-list" [multiple]="false">
        <mat-list-option *ngFor="let s of services" [value]="s.id" class="service-option">
          {{s.name}}
        </mat-list-option>
      </mat-selection-list>
      <div class="step-actions">
        <button mat-button matStepperPrevious>Atrás</button>
        <button mat-raised-button color="primary" matStepperNext [disabled]="serviceGroup.invalid">Continuar</button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="scheduleGroup">
    <form [formGroup]="scheduleGroup">
      <ng-template matStepLabel>Agenda</ng-template>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Horario Preferido</mat-label>
        <mat-select formControlName="preferredTime" required>
          <mat-option *ngFor="let slot of timeSlots" [value]="slot.value" [disabled]="!slot.available">
            {{slot.label}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-radio-group formControlName="preferredContact" class="contact-methods">
        <mat-radio-button *ngFor="let m of contactMethods" [value]="m.value">{{m.label}}</mat-radio-button>
      </mat-radio-group>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Mensaje</mat-label>
        <textarea matInput rows="3" formControlName="message"></textarea>
      </mat-form-field>
      <div class="step-actions">
        <button mat-button matStepperPrevious>Atrás</button>
        <button mat-raised-button color="primary" (click)="submit()" [disabled]="scheduleGroup.invalid">Agendar</button>
      </div>
    </form>
  </mat-step>
</mat-vertical-stepper>

<div class="success" *ngIf="showSuccess">
  <mat-icon color="primary" class="success-icon">check_circle</mat-icon>
  <p>¡Cita agendada!</p>
  <p>{{ appointmentService.getServiceById(serviceGroup.get('service')?.value)?.name }}</p>
</div>
